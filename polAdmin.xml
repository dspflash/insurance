<WndTap Name="polAdmin" Text="保单信息管理"><Ctrls>
<GroupBox Name="GBpol" id="policy" Size="700,500" Text="保单信息" overlap="GBINSURA" feature="tab"><Ctrls>        
		<Label Name="lb_polCoverTypeIDcov" Size="80,20" Text="险种类别" align="right"/>
		<ComboBox Name="polCoverTypeIDcov" Type="2" Size="100,120" SelectedIndex="0" Onload="init" ToolTip="Policy cover type e.g Comprehensive">
			<DbDetails><queryFormat>select nameCN from test.insure_cover</queryFormat></DbDetails>
			</ComboBox>
		<Button Name="addpolCoverTypeIDcov" Text="新增" Size="30,20" ToolTip="增加商品目录">
			<OnClick>
				<if cond="!%{polCoverTypeIDcov[windowtext]}"><alert expr="%{lb_polCoverTypeIDcov}不能为空"/>
				<else/>
				<DbDetails><queryFormat>insert into test.insure_cover (name,nameCN) values ('%{polCoverTypeIDcov[Letter]}','%{polCoverTypeIDcov[windowtext]}')</queryFormat></DbDetails><submit namelist="DbDetails"/>
				<DbDetails/><submit next="polCoverTypeIDcov" namelist="DbDetails"/>
				</if></OnClick>
			</Button>
		<Label Name="lb_polInsuredTypeIDins" Size="80,20" Text="投保主体类别" align="right"/>
		<ComboBox Name="polInsuredTypeIDins" Items="Company|Private" Size="100,20" SelectedIndex="1" ToolTip="Policy Insured Type e.g. Company, Private"></ComboBox>
		<Label Name="lb_polReasonIDrea" Size="80,20" Text="投保来源" align="right"/>
		<ComboBox Name="polReasonIDrea"  Items="Direct|Marketing|Broker|Agent|Reinsurance|Banc assurance" Size="100,20" SelectedIndex="1" ToolTip="Business Source e.g.?Direct, Marketing, Broker, Agent, Reinsurance, Banc assurance)"></ComboBox>
		<BR/><Label Name="lb_polReplaced" Size="80,20" Text="投保日期" align="right"/>
		<DateTime Name="polReplaced" Format="yyyy-MM-dd" Size="80,20" ToolTip="date policy record was replace on system, if null then this is the first instance"/>
<Label Name="lb_polExternalSystemID" Size="80,20" Text="内部识别码" align="right"/>
<TextBox Name="polExternalSystemID" Size="80,20" ToolTip="To be populated by the company uploading the data with a value that helps them relate this record back to their internal systems. This should not hold a value that would allow others (outside of the company supplying the record) to identify the policy. Specifically, this should not be populated with a policy number. This column is not expected to be unique in the staging or master databases. It is expected that records relating to the same policy will have the same polClientID."/>
<Label Name="lb_polSystemID" Size="80,20" Text="polSystemID" align="right"/>
<TextBox Name="polSystemID" Size="80,20" ToolTip="Generated by ARDR when records are added to the master database. This is generated using the database''s UUID function."/>
		<BR/><Label Name="lb_polInception" Size="80,20" Text="保单生效日" align="right"/>
		<DateTime Name="polInception" Format="yyyy-MM-dd" Size="80,20" ToolTip="policy inception date"/>
		<Label Name="lb_polExpiry" Size="80,20" Text="保单到期日" align="right"/>
		<DateTime Name="polExpiry" Format="yyyy-MM-dd" Size="80,20" Text="1 year" ToolTip="policy expiration date"/>
		<CheckBox Name="polLeadInsurer" Size="80,20" Text="lead insurer" Checked="0" ToolTip="is this the lead insurer"/>
<BR/><Label Name="lb_polCoInsuranceCover" Size="80,20" Text="投保比例" align="right"/>
<TextBox Name="polCoInsuranceCover" Size="80,20" ToolTip="percentage co - insured"/>
<Label Name="lb_polFacultativeCover" Size="80,20" Text="临时分保占比" align="right"/>
<TextBox Name="polFacultativeCover" Size="80,20" ToolTip="percentage of facultative cover"/>
<Label Name="lb_polQuotaShare" Size="80,20" Text="percentage of quote share" align="right"/>
<TextBox Name="polQuotaShare" Size="80,20" ToolTip="percentage of quote share"/>
<Label Name="lb_polTax" Size="80,20" Text="应税比例" align="right"/>
<TextBox Name="polTax" Size="80,20" ToolTip="percentage of Tax"/>
		<BR/><Label Name="lb_polUWYear" Size="80,20" Text="承保年度" align="right"/>
		<DateTime Name="polUWYear" Format="yyyy" Size="50,20" ToolTip="underwriting year or year of account"/>
<Label Name="lb_polGrossPremiumAmount" Size="80,20" Text="总保额" align="right"/>
<TextBox Name="polGrossPremiumAmount" Size="80,20" ToolTip="gross premium amount"/>
<TextBox Name="polGrossPremiumIDccy" Size="30,20" Text="CNY" Tooltip="币种"/>
<Label Name="lb_driPolicyIDpol" Size="80,20" Text="驾驶人ID" align="right"/>
<TextBox Name="driPolicyIDpol" Size="80,20"/>
		<TextBox Name="polID" Visible="false" Size="20,20" ToolTip="保单号码">
				<DbDetails>
					<queryFormat>select polID,1 as newpol from test.insure_policy where driPolicyIDpol='%{session.driid}' and polEnterBy=%{user_code} order by polEnterAt desc limit 0,1</queryFormat> 
				</DbDetails>
			<OnEnChange><if cond="%{polID[newpol]}"><submit next="updatevehpol" function="click"/></if></OnEnChange>
			</TextBox>        

		<BR/><ListCtrl Name="polLst"  PageSize="10" Size="400,100" loadedclick="false" OnClick="" OnLoad="init"
			 Heading="保单生效日,100;保单到期日,100;险种类别,100;总保额,100;">
			<DbDetails fcsm="1">
				<DbTable>test.insure_policy</DbTable>
				<Index>d_id</Index>
				<Data>polInception, polExpiry, polCoverTypeIDcov,polGrossPremiumAmount,polLeadInsurer, polCoInsuranceCover, polFacultativeCover, polQuotaShare, polTax, polUWYear,driPolicyIDpol,polGrossPremiumIDccy,polID,insuraID</Data>
				<Order></Order>
				<Where>id_corp='%{id_corp}'%{extentcond}</Where>
				</DbDetails>
			<OnClick><if cond="!%{polLst[insura_idx]}"><submit next="properties" function="resetcontent"/><else/>
					<submit next="properties"/>
			</if></OnClick>
			</ListCtrl>
		<TAB/><GroupBox Name="GBOP" Size="80,20" Text="操作"><Ctrls>
		<Button Name="insertpol"   Size="50,20" Text="添加">
			<OnClick><if cond="!'%{session.driid}'"><alert expr="请选择驾驶人"/>
			<else/>
				<DbDetails fcsm="1">
					<data>polInception, polExpiry, polCoverTypeIDcov,polLeadInsurer, polCoInsuranceCover, polFacultativeCover, polQuotaShare, polTax, polUWYear, polGrossPremiumAmount, polGrossPremiumIDccy</data>
					<dataEx>id_corp,driPolicyIDpol,polEnterBy,polEnterAt,insuraID;%{id_corp},'%{session.driid}',%{user_code},UNIX_TIMESTAMP(),'%{session.insid}'</dataEx>
					<queryFormat>insert into test.insure_policy %{data}</queryFormat></DbDetails><submit namelist="DbDetails"/>
				<submit next="polID" method="post"/><submit next="polLst" method="post"/>
				</if>
			</OnClick></Button>
		<Button Name="deletepol" Size="50,20" Text="删除">
			<OnClick>
				<DbDetails>
				<DbTable>test.insure_policy</DbTable>
				<Where>polID='%{polLst[polID]}'</Where>
				<queryFormat>delete from %{dbtable} where %{where}</queryFormat></DbDetails><submit namelist="DbDetails"/>
				<submit next="polLst"/>
			</OnClick></Button>
		<BR/><Button Name="refreshpol"   Size="50,20" Text="刷新" >
			<OnClick>
				<submit next="polLst"/>
			</OnClick></Button>
		<Button Name="updatevehpol"  visible="0" Size="50,20" Text="更新车辆保险信息">
			<OnClick>
				<DbDetails><queryFormat>update test.insure_vehicle set vehPolicyIDpol='%{polID}' where vehID ='%{session.vehid}'</queryFormat></DbDetails><submit namelist="DbDetails"/>
			</OnClick></Button>
			</Ctrls></GroupBox>

	</Ctrls></GroupBox></Ctrls>
	</WndTap>
